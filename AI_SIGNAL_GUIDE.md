# 📱 AI 操作指令使用指南

## 🎯 核心理念

**不再需要理解复杂的"做T"、"加仓"、"减仓"等概念！**

AI 现在只给你**3种简单明确的指令**：

| 指令 | 表情 | 含义 | 执行方式 |
|-----|------|------|---------|
| **立即买入** 🟢 | 绿灯 | 现在就是好的买点 | 按建议价格和数量立即买入 |
| **立即卖出** 🔴 | 红灯 | 现在就是好的卖点 | 按建议价格和数量立即卖出 |
| **暂不操作** ⚪ | 等待 | 等待更好时机 | 什么也不做，继续观望 |

---

## 📊 输出示例

### 示例 1：立即卖出

```
🔴 AI 操作指令: 159218
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📊 当前行情 (2025-12-26)
   当前价: 1.625  |  涨跌: 3.64%
   日内区间: 1.555 ~ 1.637 (当前位于 85% 位置)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🎯 操作指令: 立即卖出

💰 执行价格: 1.625
📊 建议数量: 50.0%
🛡️ 止损价格: 1.637
🎁 目标价格: 1.550

💡 核心原因: 价格日内涨幅过大，已触及日内高位，短期获利了结压力大。
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

**如何执行？**
1. 打开交易软件
2. 输入代码：159218
3. 卖出价格：1.625（或当前市价）
4. 卖出数量：持仓的 50%
5. 设置止损：如果价格突破 1.637，立即平仓

### 示例 2：暂不操作

```
⚪ AI 操作指令: 159840
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📊 当前行情 (2025-12-26)
   当前价: 0.869  |  涨跌: 2.36%
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🎯 操作指令: 暂不操作

💡 核心原因: 股价已大幅上涨至日内高位，短期偏离MA5较远，追高风险大，等待回调或盘整。
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

**如何执行？**
- 什么都不做，继续观望
- 等待下一次"立即买入"或"立即卖出"信号

---

## 🚀 使用方式

### 方式 1：实时监控（推荐）

监控脚本会每分钟检查一次，**只有触发"立即买入"或"立即卖出"时才会通知你**！

```bash
cd /Users/huan.yu/dev/demo/stock/tushare-mcp

# 运行监控（会自动加载 .env 配置）
uv run python monitor_intraday_signals.py
```

**配置说明**（在 `monitor_intraday_signals.py` 的 `main()` 函数中）：

```python
# 1. 关注的股票代码
codes = ["159218", "159840"]

# 2. 持仓信息（用于AI分析）
position_costs = {
    "159218": 1.55,   # 持仓成本价
    "159840": None,   # None 表示空仓
}
position_ratios = {
    "159218": 0.5,    # 当前仓位 50%
    "159840": 0.0,    # 空仓
}

# 3. 其他配置
interval = 60.0           # 检查间隔（秒）
enable_feishu = True      # 是否启用飞书通知
enable_deepseek = True    # 是否启用 AI 分析
use_t_signal = True       # 是否使用简化指令模式
```

### 方式 2：手动查询

快速查询当前时刻的AI建议：

```bash
cd /Users/huan.yu/dev/demo/stock/tushare-mcp

# 运行测试脚本
uv run python test_ai_signal_now.py
```

或者直接调用：

```bash
uv run python -c "from tushare_mcp import deepseek_intraday_t_signal; print(deepseek_intraday_t_signal('159218', position_cost=1.55, position_ratio=0.5))"
```

---

## ⚙️ 配置文件

确保 `.env` 文件包含以下配置：

```bash
# DeepSeek API Key（必需）
DEEPSEEK_API_KEY=sk-your-key-here

# MySQL 连接（用于读取历史数据）
MYSQL_URL=mysql+pymysql://user:pass@localhost:3306/stock_data

# 飞书 Webhook（可选，用于消息通知）
FEISHU_WEBHOOK_URL=https://open.feishu.cn/open-apis/bot/v2/hook/your-webhook
```

---

## 🔔 通知方式

### 1. 控制台输出

监控运行时，会在终端打印：

```
==================================================
⏰ 14:35:12  |  159218
==================================================
🔴  【立即卖出】
──────────────────────────────────────────────────
💰 执行价格: 1.625
📊 建议数量: 50.0%
🛡️ 止损价格: 1.637
🎯 目标价格: 1.550
──────────────────────────────────────────────────
💡 原因: 价格日内涨幅过大，已触及日内高位
==================================================
```

### 2. 飞书机器人通知

如果配置了 `FEISHU_WEBHOOK_URL`，会同时发送飞书消息到手机/电脑端。

---

## 📝 注意事项

### 1. AI 建议不是 100% 准确

- AI 基于历史数据和技术指标分析
- 市场存在不可预测的突发事件
- **建议仅供参考，不构成投资建议**

### 2. 合理使用止损

AI 会给出止损价格，**强烈建议严格执行**：
- 如果是"立即买入"，当价格跌破止损价时立即卖出
- 如果是"立即卖出"，当价格突破止损价时立即回补

### 3. 不要频繁操作

监控脚本有防重复打印机制：
- 同一个标的，只有信号**变化**时才会通知
- 例如：已经提示"立即卖出"后，下次除非变成"立即买入"或"暂不操作"，否则不会重复提示

### 4. 交易时段

默认配置 `all_day = True`，即全天监控。如果只想在交易时段监控（9:30-11:30, 13:00-15:00），可以修改为：

```python
all_day = False
```

---

## 🛠️ 故障排查

### 问题 1：输出显示"未配置 MYSQL_URL"

**解决方案**：
```bash
# 检查 .env 文件是否存在
cat /Users/huan.yu/dev/demo/stock/tushare-mcp/.env

# 确保包含 MYSQL_URL
MYSQL_URL=mysql+pymysql://user:pass@localhost:3306/stock_data
```

### 问题 2：DeepSeek API 调用失败

**解决方案**：
```bash
# 检查 API Key 是否正确
cat /Users/huan.yu/dev/demo/stock/tushare-mcp/.env | grep DEEPSEEK_API_KEY

# 测试 API 连接
uv run python test_ai_signal_now.py
```

### 问题 3：飞书通知不工作

**解决方案**：
- 检查 `FEISHU_WEBHOOK_URL` 是否正确
- 确保飞书机器人已添加到群组
- 测试 Webhook：
  ```bash
  curl -X POST "https://open.feishu.cn/open-apis/bot/v2/hook/your-webhook" \
    -H "Content-Type: application/json" \
    -d '{"msg_type":"text","content":{"text":"测试"}}'
  ```

---

## 📚 相关文档

- [QUICKSTART.md](./QUICKSTART.md) - 完整的系统搭建指南
- [T_TRADING_GUIDE.md](./T_TRADING_GUIDE.md) - T+0 交易策略详解（已过时，新版不再需要）

---

## 📞 支持

遇到问题？欢迎提 Issue！

**记住：AI 只是辅助工具，投资决策需要你自己谨慎判断！** 🚀

