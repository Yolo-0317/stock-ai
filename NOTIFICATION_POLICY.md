# 📱 通知策略说明

## 🎯 通知原则

本系统采用**智能通知策略**，在需要及时响应的场景推送通知，在需要静心分析的场景只记录日志。

---

## 📊 各功能通知策略

| 功能 | 时段 | 飞书通知 | 日志记录 | 说明 |
|------|------|----------|----------|------|
| **盘前分析** 🌅 | 8:30-9:00 | ❌ 不推送 | ✅ 记录 | 固定时间查看即可，无需推送 |
| **盘中监控** 📊 | 9:30-15:00 | ✅ 实时推送 | ✅ 记录 | 把握交易时机，需要及时通知 |
| **盘后复盘** 🌙 | 15:30-16:00 | ❌ 不推送 | ✅ 记录 | 固定时间查看即可，无需推送 |

---

## 💡 设计理念

### 1. **盘前/盘后 - 不推送通知**

**原因：**
- ⏰ 固定时间执行，可以主动查看
- 📖 内容较长，适合静心阅读
- 🧘 避免信息过载，保持专注

**使用方式：**
```bash
# 手动运行并查看结果
uv run python run_premarket_analysis.py
uv run python run_aftermarket_analysis.py

# 或查看日志文件
cat logs/premarket_$(date +%Y%m%d).log
cat logs/aftermarket_$(date +%Y%m%d).log
```

**自动化场景：**
- 设置定时任务自动运行
- 需要时主动查看日志文件
- 早上到公司/晚上回家后查看

---

### 2. **盘中监控 - 实时推送**

**原因：**
- ⚡ 时机稍纵即逝，需要及时通知
- 📱 方便随时随地接收信号
- 🎯 只推送关键信号（买入/卖出）

**推送内容：**
```
==================================================
⏰ 10:15:30  |  159218
==================================================
🔴 卖出  【立即卖出】
──────────────────────────────────────────────────
💰 执行价格: 1.625
📊 建议数量: 50.0%
💡 原因: 价格已大幅偏离均线
==================================================
```

**优势：**
- ✅ 信息简洁，易于快速决策
- ✅ 移动端友好，随时可看
- ✅ 只推送重要信号，不刷屏

---

## ⚙️ 配置说明

### 盘前分析 (`run_premarket_analysis.py`)

```python
# 是否发送飞书通知（盘前分析不需要推送，仅记录日志）
ENABLE_FEISHU = False  # 默认禁用
```

### 盘后分析 (`run_aftermarket_analysis.py`)

```python
# 是否发送飞书通知（盘后分析不需要推送，仅记录日志）
ENABLE_FEISHU = False  # 默认禁用
```

### 盘中监控 (`monitor_intraday_signals.py`)

```python
enable_feishu = True   # 默认启用
enable_deepseek = True # 启用 AI 分析
use_t_signal = True    # 使用 T+0 信号
```

---

## 🔧 自定义通知策略

### 如果你想启用盘前/盘后通知

修改对应脚本中的配置：

```python
ENABLE_FEISHU = True  # 改为 True
```

### 如果你想禁用盘中通知

修改 `monitor_intraday_signals.py`：

```python
enable_feishu = False  # 改为 False
```

### 只在特定情况下推送

修改 `monitor_intraday_signals.py`，添加条件判断：

```python
# 只推送买入/卖出信号，不推送"暂不操作"
if should_print and signal in ("立即买入", "立即卖出"):
    if enable_feishu and FEISHU_ENABLED:
        send_to_lark(msg, is_error=False)
```

---

## 📱 飞书通知使用建议

### 1. **合理设置通知时段**

- **交易时段**：开启所有通知
- **非交易时段**：可以静音或关闭通知
- **休息时间**：建议关闭通知，避免打扰

### 2. **通知频率控制**

当前策略：
- 盘中监控：只在信号**变化**时推送（避免重复）
- 盘前/盘后：不推送（手动查看）

### 3. **通知内容优化**

- ✅ 简洁明了，核心信息突出
- ✅ 包含执行价格、建议数量等关键数据
- ✅ 格式统一，易于识别

---

## 📊 通知流程图

```
┌─────────────────────────────────────────┐
│           系统分析引擎                   │
└──────────────┬──────────────────────────┘
               │
               ├─── 🌅 盘前分析
               │    • 只记录日志
               │    • 主动查看
               │
               ├─── 📊 盘中监控
               │    • 实时推送飞书 ✅
               │    • 同时记录日志
               │
               └─── 🌙 盘后分析
                    • 只记录日志
                    • 主动查看
```

---

## 💡 使用建议

### 工作日交易时段

1. **早上 8:30-9:00**
   - 手动运行盘前分析
   - 或查看自动运行的日志
   - 制定今日交易计划

2. **盘中 9:30-15:00**
   - 启动监控脚本（后台运行）
   - 专注工作，等待飞书通知
   - 收到信号后及时决策

3. **下午 15:30-16:00**
   - 手动运行盘后分析
   - 或查看自动运行的日志
   - 复盘今日操作

### 周末/节假日

- 监控脚本会自动检测交易日
- 非交易日不会运行分析
- 可以回顾历史日志，总结经验

---

## 🔍 故障排查

### 盘中通知没有收到

1. **检查飞书 Webhook**
   ```bash
   # 测试飞书通知
   python -c "from feishu_notice import send_to_lark; send_to_lark('测试消息')"
   ```

2. **检查配置**
   ```bash
   # 确认 enable_feishu = True
   grep "enable_feishu" monitor_intraday_signals.py
   ```

3. **查看日志**
   ```bash
   # 查看是否有错误
   tail -50 logs/monitor_$(date +%Y%m%d).log
   ```

### 收到太多通知

修改配置，只推送关键信号：

```python
# 只推送买入/卖出，不推送"暂不操作"
print_all_signals = False

# 或修改推送逻辑，增加过滤条件
```

---

## 📚 相关文档

- [COMPLETE_GUIDE.md](./COMPLETE_GUIDE.md) - 完整使用指南
- [CONFIG_GUIDE.md](./CONFIG_GUIDE.md) - 配置详解
- [DAILY_ANALYSIS_GUIDE.md](./DAILY_ANALYSIS_GUIDE.md) - 盘前/盘后分析

---

**智能通知，专注交易！** 📱✨

